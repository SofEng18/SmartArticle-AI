<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartArticle AI</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(to bottom left, #f0f4f8, #cbd5e1);
      min-height: 100vh;
    }
    #result {
      white-space: pre-wrap;
      word-wrap: break-word;
      background-color: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 1rem;
      border-radius: 0.75rem;
      height: 16rem;
      overflow-y: auto;
      position: relative;
    }
    #result::after {
      content: "";
      position: absolute;
      right: 1rem;
      bottom: 1rem;
      width: 10px;
      height: 10px;
      background-color: #3b82f6;
      border-radius: 50%;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body class="text-gray-800 flex flex-col justify-between">

  <header class="bg-gradient-to-r from-indigo-600 to-blue-500 shadow-md py-4">
    <div class="container mx-auto flex justify-between items-center px-4">
      <h1 class="text-2xl font-bold text-white">🧠 SmartArticle AI</h1>
      <nav class="flex items-center gap-2">
        <!-- Changed "الأسعار" to "الاشتراك" -->
        <a href="pricing.html" class="text-white hover:text-yellow-300 mx-2">💰 <span id="pricing-label">الاشتراك</span></a>
        <label for="language" class="text-sm text-white mr-2 hidden sm:inline" id="lang-label">اللغة:</label>
        <select id="language" class="border rounded p-1 text-sm">
          <option value="ar">العربية</option>
          <option value="en">English</option>
          <option value="fr">Français</option>
        </select>
      </nav>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8 flex-grow">
    <div class="bg-white p-6 rounded-2xl shadow-lg max-w-3xl mx-auto">
      <h2 class="text-xl font-bold mb-4 text-center text-gray-700" id="input-title">✍️ أدخل موضوع المقال:</h2>
      <input id="topic" type="text" placeholder="مثال: تأثير الذكاء الاصطناعي على التعليم"
             class="w-full p-3 rounded border focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4">
      <div class="flex justify-between items-center mb-4">
        <label for="length" class="text-gray-700 text-base font-medium" id="length-label">طول المقال:</label>
        <select id="length" class="border rounded p-2 text-sm">
          <option value="short">قصير</option>
          <option value="medium" selected>متوسط</option>
          <option value="long">طويل</option>
        </select>
      </div>
      <button id="generate-button"
              class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl font-semibold w-full transition duration-300">
        🚀 توليد المقال
      </button>
      <div id="result" class="mt-6 text-gray-800 transition-all duration-500">
        📰 المقال سيظهر هنا...
      </div>

      <!-- Social Share Icons with proper links -->
      <div class="flex justify-center space-x-4 mt-6 text-blue-600 text-xl rtl:space-x-reverse">
        <a href="https://wa.me/?text=Check%20this%20article" title="شارك عبر واتساب" target="_blank"><i class="fab fa-whatsapp"></i></a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://smartarticle.example" title="شارك عبر فيسبوك" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="https://twitter.com/intent/tweet?url=https://smartarticle.example" title="شارك عبر تويتر" target="_blank"><i class="fab fa-twitter"></i></a>
        <a href="https://t.me/share/url?url=https://smartarticle.example" title="شارك عبر تيليجرام" target="_blank"><i class="fab fa-telegram"></i></a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://smartarticle.example" title="شارك عبر لينكدإن" target="_blank"><i class="fab fa-linkedin"></i></a>
      </div>
    </div>
  </main>

  <footer class="bg-gradient-to-r from-indigo-600 to-blue-500 shadow-inner py-4 mt-6">
    <div class="container mx-auto text-center text-sm text-white font-semibold">
      Nadim Al-Selwi © 2025 SmartArticle AI
    </div>
  </footer>

  <script>
    let currentLanguage = "ar";
    const topicInput = document.getElementById("topic");
    const resultBox = document.getElementById("result");
    const lengthSelect = document.getElementById("length");
    const lengthLabel = document.getElementById("length-label");

    const messages = {
      ar: {
        placeholder: "مثال: تأثير الذكاء الاصطناعي على التعليم",
        loading: "⏳ جاري توليد المقال...",
        result: "📰 المقال سيظهر هنا...",
        empty: "يرجى إدخال موضوع المقال",
        inputTitle: "✍️ أدخل موضوع المقال:",
        lengthLabel: "طول المقال:",
        pricing: "الاشتراك",
        button: "🚀 توليد المقال"
      },
      en: {
        placeholder: "Example: The impact of AI on education",
        loading: "⏳ Generating the article...",
        result: "📰 The article will appear here...",
        empty: "Please enter an article topic",
        inputTitle: "✍️ Enter the article topic:",
        lengthLabel: "Article length:",
        pricing: "Subscribe",
        button: "🚀 Generate Article"
      },
      fr: {
        placeholder: "Exemple : L’impact de l’IA sur l’éducation",
        loading: "⏳ Génération de l’article en cours...",
        result: "📰 L’article apparaîtra ici...",
        empty: "Veuillez entrer un sujet d’article",
        inputTitle: "✍️ Saisissez le sujet de l’article :",
        lengthLabel: "Longueur de l’article :",
        pricing: "S'abonner",
        button: "🚀 Générer l’article"
      }
    };

    const lengthOptions = {
      ar: { short: "قصير", medium: "متوسط", long: "طويل", label: "طول المقال:" },
      en: { short: "Short", medium: "Medium", long: "Long", label: "Article length:" },
      fr: { short: "Court", medium: "Moyen", long: "Long", label: "Longueur de l’article :" }
    };

    function adjustLanguageUI(lang) {
      topicInput.placeholder = messages[lang].placeholder;
      resultBox.innerHTML = messages[lang].result;
      document.getElementById("input-title").innerText = messages[lang].inputTitle;
      document.getElementById("generate-button").innerText = messages[lang].button;
      document.getElementById("pricing-label").innerText = messages[lang].pricing;

      const opts = lengthOptions[lang];
      lengthLabel.textContent = opts.label;
      lengthSelect.innerHTML = `
        <option value="short">${opts.short}</option>
        <option value="medium" selected>${opts.medium}</option>
        <option value="long">${opts.long}</option>
      `;
    }

    function updatePageDirection(lang) {
      const html = document.documentElement;
      html.lang = lang;
      html.dir = lang === "ar" ? "rtl" : "ltr";
      document.body.style.direction = lang === "ar" ? "rtl" : "ltr";
      document.body.style.textAlign = lang === "ar" ? "right" : "left";
      topicInput.style.direction = lang === "ar" ? "rtl" : "ltr";
      topicInput.style.textAlign = lang === "ar" ? "right" : "left";
      resultBox.style.direction = lang === "ar" ? "rtl" : "ltr";
      resultBox.style.textAlign = lang === "ar" ? "right" : "left";
    }

    document.getElementById("language").addEventListener("change", (e) => {
      currentLanguage = e.target.value;
      adjustLanguageUI(currentLanguage);
      updatePageDirection(currentLanguage);
    });

    document.getElementById("generate-button").addEventListener("click", async () => {
      const topic = topicInput.value.trim();
      resultBox.innerHTML = "";

      if (!topic) {
        alert(messages[currentLanguage].empty);
        resultBox.innerHTML = messages[currentLanguage].result;
        return;
      }

      try {
        resultBox.innerHTML = messages[currentLanguage].loading;

        const response = await fetch("/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic, language: currentLanguage, length: lengthSelect.value })
        });

        if (!response.ok || !response.body) {
          resultBox.innerHTML = '<span class="text-red-600">❌ خطأ في الاتصال بالخادم</span>';
          return;
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder("utf-8");
        resultBox.innerHTML = "";

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          const chunk = decoder.decode(value, { stream: true });
          resultBox.innerHTML += chunk;
          resultBox.scrollTop = resultBox.scrollHeight;
        }

      } catch (err) {
        resultBox.innerHTML = `<span class="text-red-600">❌ ${err.message}</span>`;
      }
    });

    adjustLanguageUI(currentLanguage);
    updatePageDirection(currentLanguage);
  </script>
</body>
</html>
